# 服务注册与发现

## 形态

1. IP 直连

2. 域名 + DNS

3. 注册中心

   > 注册中心容易成为大集群的瓶颈

4. 借助网关的注册与发现

## 内容

1. 服务自省  

   > 阿里 Dubbo 提出的概念跟服务有关的元数据，通过一个元数据服务来暴露

2. 推拉模式

3. 服务端和注册中心保持心跳

   > 服务端主动还是注册中心主动发起心跳
   >
   > 高级用法但不常用：
   >
   > 双向心跳
   >
   > 单向心跳失败之后，另外一边主动发起心跳

4. 服务优雅下线 

   > 首先要通知注册中心，然后服务端节点不再接受新请求 服务端需要等待正在处理的请求结束 等服务端已经接收的请求处理完毕，服务端就会结束运行，或者超过超时时间，就会直接退出

5. 注册中心高可用 

   - 部署一个集群多活方案（定时演练） 

   - 双注册中心方案 

   - 按业务拆分多个注册中心 

   - 业务拆分多个注册中心同时备份其他业务的注册中心（23混用） 

6. 分布式 CAP 理论

   >  一个分布式系统不可能同时满足 一致性 可用性 分区容错性

7. 选择 CP 还是 AP？

   > 放弃 A 和 B 之间同步数据，就意味着放弃了一致性
   >
   > 放弃 A 和 B 对外服务， 就意味着放弃了 可用性
   >
   > 一般选择可用性，AP + 客户端容错

